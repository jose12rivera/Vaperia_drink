@page "/Clientes/Delete/{ClienteId:int}"
@inject ClienteService clienteService
@inject NavigationManager navigationManager
@inject ToastService toastService
@rendermode InteractiveServer

<PageTitle>Eliminar Cliente</PageTitle>

<div class="container mt-5">
    <div class="card shadow-lg border-0">
        <div class="card-header text-center py-4" style="background-color: #dc3545; color: #fff;">
            <h2><i class="bi bi-exclamation-triangle me-2"></i> Confirmar Eliminación</h2>
        </div>

        <div class="card-body">
            @if (cliente != null)
            {
                <div class="alert alert-warning">
                    <h5>¿Está seguro que desea eliminar este cliente?</h5>
                    <p class="mb-0">Esta acción no se puede deshacer.</p>
                </div>

                <p><strong>Teléfono:</strong> @cliente.Telefono</p>
                <p><strong>Nombre:</strong> @cliente.Nombre</p>
            }
            else
            {
                <div class="alert alert-danger text-center">
                    <i class="bi bi-exclamation-triangle me-2"></i> Cliente no encontrado.
                </div>
            }
        </div>

        <div class="card-footer text-center bg-light">
            @if (cliente != null)
            {
                <button class="btn btn-danger me-3" @onclick="EliminarCliente">
                    <i class="bi bi-trash-fill me-2"></i> Confirmar Eliminación
                </button>
            }
            <button class="btn btn-secondary" @onclick="Volver">
                <i class="bi bi-arrow-left-circle-fill me-2"></i> Cancelar
            </button>
        </div>
    </div>
</div>

@code {
    [Parameter] public int ClienteId { get; set; }
    private Clientes? cliente;

    protected override async Task OnInitializedAsync()
    {
        cliente = await clienteService.Buscar(ClienteId);
    }

    private async Task EliminarCliente()
    {
        if (cliente != null)
        {
            var ok = await clienteService.Eliminar(cliente.ClienteId);
            if (ok)
            {
                toastService.Notify(new ToastMessage(ToastType.Success, "Eliminación Exitosa", "Cliente eliminado correctamente."));
                await Task.Delay(1500);
                navigationManager.NavigateTo("/Clientes/Index");
            }
            else
            {
                toastService.Notify(new ToastMessage(ToastType.Danger, "Error", "No se pudo eliminar el cliente."));
            }
        }
    }

    private void Volver() => navigationManager.NavigateTo("/Clientes/Index");
}
